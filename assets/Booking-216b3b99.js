import{z as U,A,D as F,u as Y,d as J,j as e,b as z,C as S,e as k,c as w,a as D,E as V,I as C,h as _,i as G,k as H,F as R,l as W,m as K,B as L}from"./index-5f193234.js";import{r as $}from"./vendor-react-79a2b980.js";import{T as Q}from"./textarea-6f9b02fd.js";import{b as X}from"./vendor-router-2e3f95c9.js";import{d as E,e as Z,f as ee,M as se,G as te,n as I,P as ae,o as ne,J as ie}from"./vendor-ui-a51f4cb7.js";new Date().toISOString().split("T")[0],new Date().toISOString().split("T")[0],new Date(Date.now()+864e5).toISOString().split("T")[0];const f=[];`${Math.random().toString(36).substr(2,9)}`;function re(){const o=Date.now(),d=f.length;for(let l=f.length-1;l>=0;l--)f[l].expiresAt<o&&f.splice(l,1);const c=d-f.length;c>0&&U.debug(`Cleaned up ${c} expired reservations`)}function oe(){if(typeof window>"u")return`session-${Math.random().toString(36).slice(2)}-${Date.now()}`;try{const o="espinosa-reservation-session",d=window.sessionStorage.getItem(o);if(d)return d;const c=typeof crypto<"u"&&"randomUUID"in crypto?`session-${crypto.randomUUID()}`:`session-${Math.random().toString(36).slice(2)}-${Date.now()}`;return window.sessionStorage.setItem(o,c),c}catch{return`session-${Math.random().toString(36).slice(2)}-${Date.now()}`}}function le(o,d,c){const l=o.filter(a=>a.type==="service"),b=l.filter(a=>!a.bookingDetails);if(b.length>0)return{success:!1,error:`${b.length} service(s) missing booking details`};const j=oe(),m=A(j),x=new Date;for(const a of l){const i=a.bookingDetails;if(!(i!=null&&i.reservationId))continue;const h=m.find(u=>u.id===i.reservationId);if(!h)return{success:!1,error:`Reservation for ${a.name} not found or expired`};if(new Date(h.reservedUntil)<x)return{success:!1,error:`Reservation for ${a.name} has expired`}}const v=Date.now().toString(36).toUpperCase(),y=Math.random().toString(36).substring(2,6).toUpperCase(),p=`ESP-${v}-${y}`;return U.logBooking("Booking confirmed",{confirmationCode:p,customer:d,items:o.map(a=>({name:a.name,type:a.type,booking:a.bookingDetails})),payment:c,total:o.reduce((a,i)=>a+i.price*i.quantity,0)}),l.forEach(a=>{var i;(i=a.bookingDetails)!=null&&i.reservationId&&F(a.bookingDetails.reservationId)}),{success:!0,confirmationCode:p}}typeof window<"u"&&setInterval(re,6e4);function he(){const o=X(),{state:d,clearCart:c,getCartSummary:l,getServices:b,getProducts:j,formatPrice:m}=Y(),{error:x,success:v}=J(),{isEmpty:y,servicesSubtotal:p,productsSubtotal:a,tax:i,total:h}=l(),u=b(),N=j(),M=s=>{const r={className:"h-4 w-4"};switch(s){case"Banknote":return e.jsx(ie,{...r});case"Smartphone":return e.jsx(ne,{...r});case"CreditCard":return e.jsx(I,{...r});default:return e.jsx(I,{...r})}},[t,g]=$.useState({name:"",email:"",phone:"",paymentMethod:"",specialRequests:""}),[P,q]=$.useState(!1);if(y)return o("/services",{state:{message:"Your cart is empty. Browse our services and products to get started."}}),null;const T=u.filter(s=>!s.bookingDetails);if(T.length>0)return x("Booking Required",`${T.length} service(s) need booking details. Please complete booking in cart first.`),o("/services"),null;const O=async s=>{if(s.preventDefault(),!t.name||!t.email||!t.phone||!t.paymentMethod){x("Missing Information","Please fill in all required fields");return}q(!0);try{const r=le(d.items,{name:t.name,email:t.email,phone:t.phone},t.paymentMethod);if(r.success&&r.confirmationCode){const B={confirmationCode:r.confirmationCode,services:u.map(n=>({id:n.id,name:n.name,price:n.price,quantity:n.quantity,duration:n.duration,description:n.description,bookingDetails:{date:n.bookingDetails.date,timeSlot:n.bookingDetails.timeSlot,location:n.bookingDetails.locationId,vehicleType:n.bookingDetails.vehicleType||""}})),products:N.map(n=>({id:n.id,name:n.name,price:n.price,quantity:n.quantity,description:n.description})),customer:{name:t.name,email:t.email,phone:t.phone,paymentMethod:t.paymentMethod,specialRequests:t.specialRequests},totals:{servicesSubtotal:p,productsSubtotal:a,tax:i,total:h},createdAt:new Date().toISOString()};localStorage.setItem("demo-booking",JSON.stringify(B)),c(),v("Booking Confirmed!",`Your confirmation code is: ${r.confirmationCode}`),o("/booking-confirmation",{state:{bookingData:B}})}else x("Booking Failed",r.error||"Unable to confirm booking. Please try again.")}catch{x("Error","An unexpected error occurred. Please try again.")}finally{q(!1)}};return e.jsx("div",{className:"min-h-screen bg-brand-cream py-32",children:e.jsx(z,{children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("h1",{className:"text-4xl font-bold text-brand-dark mb-8",children:"Complete Your Booking"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(S,{children:[e.jsx(k,{children:e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-5 w-5 text-green-600"}),"Booking Details Confirmed"]})}),e.jsx(D,{className:"space-y-4",children:u.map(s=>e.jsxs("div",{className:"border-l-4 border-green-500 pl-4 py-2 bg-green-50",children:[e.jsx("h3",{className:"font-semibold text-brand-dark",children:s.name}),s.bookingDetails&&e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-2 text-sm text-neutral-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Z,{className:"h-3 w-3"}),new Date(s.bookingDetails.date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ee,{className:"h-3 w-3"}),V(s.bookingDetails.timeSlot)]}),e.jsxs("div",{className:"flex items-center gap-1 col-span-2",children:[e.jsx(se,{className:"h-3 w-3"}),s.bookingDetails.locationName]})]})]},s.id))})]}),e.jsxs(S,{children:[e.jsx(k,{children:e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5 text-brand-primary"}),"Your Information"]})}),e.jsx(D,{children:e.jsxs("form",{onSubmit:O,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Full Name *"}),e.jsx(C,{type:"text",placeholder:"Juan Dela Cruz",value:t.name,onChange:s=>g({...t,name:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Email *"}),e.jsx(C,{type:"email",placeholder:"juan@example.com",value:t.email,onChange:s=>g({...t,email:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Phone Number *"}),e.jsx(C,{type:"tel",placeholder:"+63 912 345 6789",value:t.phone,onChange:s=>g({...t,phone:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold mb-2 flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4"}),"Payment Method *"]}),e.jsxs(_,{value:t.paymentMethod,onValueChange:s=>g({...t,paymentMethod:s}),children:[e.jsx(G,{children:e.jsx(H,{placeholder:"Select payment method",children:t.paymentMethod&&(()=>{const s=R.find(r=>r.value===t.paymentMethod);return s?e.jsxs("div",{className:"flex items-center gap-2",children:[M(s.iconName),e.jsx("span",{children:s.label})]}):null})()})}),e.jsx(W,{children:R.map(s=>e.jsx(K,{value:s.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[M(s.iconName),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.label}),e.jsx("div",{className:"text-xs text-neutral-500",children:s.description})]})]})},s.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Special Requests (Optional)"}),e.jsx(Q,{placeholder:"Any special instructions or requests...",value:t.specialRequests,onChange:s=>g({...t,specialRequests:s.target.value}),rows:3})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 text-sm text-yellow-800",children:[e.jsx("strong",{children:"ðŸŽ­ Demo Mode:"})," This is a demo booking. No real payment will be processed."]}),e.jsx(L,{type:"submit",disabled:P,className:"w-full bg-brand-primary text-white hover:bg-brand-primary/90 text-lg py-6",children:P?e.jsx(e.Fragment,{children:"Processing..."}):e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"h-5 w-5 mr-2"}),"Confirm Booking - ",m(h)]})})]})})]})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(S,{className:"sticky top-24",children:[e.jsx(k,{children:e.jsx(w,{children:"Order Summary"})}),e.jsxs(D,{className:"space-y-4",children:[u.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold mb-2 text-neutral-600",children:"Services"}),u.map(s=>e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:s.name}),e.jsx("span",{className:"font-medium",children:m(s.price)})]},s.id))]}),N.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-semibold mb-2 text-neutral-600 flex items-center gap-1",children:[e.jsx(ae,{className:"h-4 w-4"}),"Products"]}),N.map(s=>e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsxs("span",{children:[s.name," x",s.quantity]}),e.jsx("span",{className:"font-medium",children:m(s.price*s.quantity)})]},s.id))]}),e.jsxs("div",{className:"border-t pt-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:m(p+a)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Tax (12% VAT)"}),e.jsx("span",{children:m(i)})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold border-t pt-2",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{className:"text-brand-primary",children:m(h)})]})]})]})]})})]})]})})})}export{he as Booking};
